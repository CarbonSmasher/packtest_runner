name: 'PackTest Runner'
description: 'Runs datapack tests using PackTest'
author: CarbonSmasher
branding:
  icon: 'check'
  color: 'green'
inputs:
  packs:
    description: 'Paths to packs to test, separated by commas'
    required: true
  minecraft-version:
    description: 'Minecraft version to use. Defaults to 1.20.4'
    required: false
    default: '1.20.4'
  packtest-url:
    description: 'URL to the PackTest mod to use. Defaults to URL for the latest version for the specified Minecraft version'
    required: false
    default: 'latest'
  fabric-api-url:
    description: 'URL to the Fabric API mod to use. Defaults to URL for the latest version for the specified Minecraft version'
    required: false
    default: 'latest'
runs:
  using: 'composite'
  steps:
    - name: Cache executable
      id: cache-executable
      uses: actions/cache@v3
      with:
        path: /packtest_runner/target/debug/packtest_runner
        key: packtest_runner_executable_${{ env.ACTION_REF }}
      env:
        ACTION_REF: ${{ github.action_ref }}
    - name: Build and run
      if: steps.cache-executable.outputs.cache-hit != 'true'
      using: 'docker'
      image: 'Dockerfile'
      args:
        - build
        - ${{ inputs.packs }}
        - ${{ inputs.minecraft-version }}
        - ${{ inputs.packtest-url }}
        - ${{ inputs.fabric-api-url }}
    - name: Run without building
      if: steps.cache-executable.outputs.cache-hit == 'true'
      using: 'docker'
      image: 'Dockerfile'
      args:
        - nobuild
        - ${{ inputs.packs }}
        - ${{ inputs.minecraft-version }}
        - ${{ inputs.packtest-url }}
        - ${{ inputs.fabric-api-url }}
